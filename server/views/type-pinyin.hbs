<!DOCTYPE html>
<html>
<head>
    <title>{{title}}</title>
    <style>
        html, body, textarea {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        .tab-container {
            border-bottom: 2px solid black;
        }

        .tab-container nav {
            height: 30px;
            padding: 10px 10px 10px 10px;
            font-size: 24px;
            display: inline-block;
            cursor: pointer;
        }

        .tab-container nav:hover {
            background-color: red;
            color: yellow;
        }

        .selected-tab {
            background-color: lightcoral;
        }

        textarea {
            width: 100%;
            font-size: 32px;
            border: 0;
            outline: none;
            float: left;
            padding-top: 10px;
            padding-left: 10px;
            box-sizing: border-box;
            caret-color: red;
        }
    </style>
</head>
<body>
<nav class="tab-container">
    <nav class="tab-1 selected-tab">Tab 1</nav>
    <nav class="tab-2">Tab 2</nav>
    <nav class="add-tab">+</nav>
</nav>
<textarea id="textarea"></textarea>

<script>
    const storageHelper = {
        getTabs: function () {
            try {
                let recents = localStorage.getItem('type-pinyin__tabs') || '[]'
                console.log(recents)
                return JSON.parse(recents)
            }
            catch (err) {
                console.error(err)
                return []
            }
        },
        getTabIndex: function () {
            return localStorage.getItem('type-pinyin__index') || 0
        },
        updateTab: function (index, text) {
            const allTabs = storageHelper.getTabs()
            allTabs[index] = text
            localStorage.setItem('type-pinyin__tabs', JSON.stringify(allTabs))
        }
    }
</script>

<script>
    function convertToneNumbersToAccents(pinyin) {

        const common = {
            a1: 'ā',
            a2: 'á',
            a3: 'ǎ',
            a4: 'à',
            a5: 'a',
            ai1: 'āi',
            ai2: 'ái',
            ai3: 'ǎi',
            ai4: 'ài',
            ai5: 'ai',
            an1: 'ān',
            an2: 'án',
            an3: 'ǎn',
            an4: 'àn',
            an5: 'an',
            ao1: 'āo',
            ao2: 'áo',
            ao3: 'ǎo',
            ao4: 'ào',
            ao5: 'ao',
            ang1: 'āng',
            ang2: 'áng',
            ang3: 'ǎng',
            ang4: 'àng',
            ang5: 'ang',
            e1: 'ē',
            e2: 'é',
            e3: 'ě',
            e4: 'è',
            e5: 'e',
            er1: 'ēr',
            er2: 'ér',
            er3: 'ěr',
            er4: 'èr',
            er5: 'er',
            en1: 'ēn',
            en2: 'én',
            en3: 'ěn',
            en4: 'èn',
            en5: 'en',
            ei1: 'ēi',
            ei2: 'éi',
            ei3: 'ěi',
            ei4: 'èi',
            ei5: 'ei',
            eng1: 'ēng',
            eng2: 'éng',
            eng3: 'ěng',
            eng4: 'èng',
            eng5: 'eng',
            i1: 'ī',
            i2: 'í',
            i3: 'ǐ',
            i4: 'ì',
            i5: 'i',
            in1: 'īn',
            in2: 'ín',
            in3: 'ǐn',
            in4: 'ìn',
            in5: 'in',
            ing1: 'īng',
            ing2: 'íng',
            ing3: 'ǐng',
            ing4: 'ìng',
            ing5: 'ing',
            o1: 'ō',
            o2: 'ó',
            o3: 'ǒ',
            o4: 'ò',
            o5: 'o',
            ou1: 'ōu',
            ou2: 'óu',
            ou3: 'ǒu',
            ou4: 'òu',
            ou5: 'ou',
            ong1: 'ōng',
            ong2: 'óng',
            ong3: 'ǒng',
            ong4: 'òng',
            ong5: 'ong',
            u1: 'ū',
            u2: 'ú',
            u3: 'ǔ',
            u4: 'ù',
            u5: 'u',
            ü1: 'ǖ',
            ü2: 'ǘ',
            ü3: 'ǚ',
            ü4: 'ǜ',
            ü5: 'ü',
            uv: 'ǚ',
            un1: 'ūn',
            un2: 'ún',
            un3: 'ǔn',
            un4: 'ùn',
            un5: 'un'
        }

        const uncommon = {
            r5: 'r',
            xx5: 'xx',
            E1: 'Ē',
            E2: 'É',
            E3: 'Ě',
            E4: 'È',
            E5: 'E',
            Er1: 'Ēr',
            Er2: 'Ér',
            Er3: 'Ěr',
            Er4: 'Èr',
            Er5: 'Er',
            A1: 'Ā',
            A2: 'Á',
            A3: 'Ǎ',
            A4: 'À',
            A5: 'A',
            An1: 'Ān',
            An2: 'Án',
            An3: 'Ǎn',
            An4: 'Àn',
            An5: 'An',
            Ang1: 'Āng',
            Ang2: 'Áng',
            Ang3: 'Ǎng',
            Ang4: 'Àng',
            Ang5: 'Ang',
            'u:1': 'ǖ',
            'u:2': 'ǘ',
            'u:3': 'ǚ',
            'u:4': 'ǜ',
            'u:5': 'ü'
        }

        for (const key in common) {
            pinyin = pinyin.replace(new RegExp(key, 'g'), common[key])
        }

        for (const key in uncommon) {
            pinyin = pinyin.replace(new RegExp(key, 'g'), uncommon[key])
        }

        return pinyin
    }

    document.addEventListener('DOMContentLoaded', function () {
        const textarea = document.getElementById('textarea')
        const savedText = storageHelper.getTabs()
        if (savedText) {
            textarea.value = savedText
        }
        textarea.focus()
    })

    document.getElementById('textarea').addEventListener('keyup', function () {
        const textarea = document.getElementById('textarea')
        textarea.value = convertToneNumbersToAccents(textarea.value)
        storageHelper.updateTab(storageHelper.getTabIndex(), textarea.value)
    })
</script>
</body>
</html>
